---
import { Icon } from "astro-icon";
const { caption, url } = Astro.props;
---

<script>
  class VideoFigure extends HTMLElement {
    connectedCallback() {
      this.video.addEventListener("mouseover", () => this.play());
      this.video.addEventListener("mouseout", () => this.pause());

      this.playButton.addEventListener("click", (e) => this.play());
      this.video.addEventListener("click", (e) => {
        if (this.video.paused) {
          this.play();
        } else {
          this.pause();
        }
      });
    }

    get video() {
      return this.querySelector("video");
    }

    get playButton() {
      return this.querySelector("#playButton");
    }

    async play() {
      try {
        await this.video.play();
        // for some reason we need to play it twice for mobile devices
        await this.video.play();

        if (this.playButton instanceof HTMLElement) {
          this.playButton.style.display = "none";
        }
      } catch (e) {}
    }

    pause() {
      this.video.pause();
      if (this.playButton instanceof HTMLElement) {
        this.playButton.style.display = "block";
      }
    }
  }

  customElements.define("video-figure", VideoFigure);
</script>

<video-figure class="relative pb-[56.25%] pt-[25px]">
  <div
    id="playButton"
    class="absolute top-2/4 left-2/4 -translate-x-1/2 -translate-y-1/2 cursor-pointer z-10 text-blue-500"
  >
    <Icon name="mdi:play-circle-outline" size="4rem" />
  </div>

  <video loop preload="auto" class="w-full h-auto rounded">
    <source src={url} type="video/webm" />
  </video>
  <figcaption class="text-sm m-0 text-center pt-1 px-2 mb-4">
    {caption}
  </figcaption>
</video-figure>
